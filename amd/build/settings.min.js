define ("local_drift/settings",["jquery","core/str","core/modal_factory","core/templates","local_drift/drift"],function(a,b,c,d,f){return{init:function init(g){var h=a("#admin-clientkey"),i=a("<div></div>").attr("class","form-setting"),j=a("<div></div>").attr("class","form-select"),k=a("<button>Test connection</button>").attr("id","drift_test_connection");if(h.hasClass("row")){i.attr("class","row");j.attr("class","offset-sm-3 col-sm-3");k.css("margin-bottom","1em")}k.attr("class","btn btn-primary").attr("type","submit");j.append(k);i.append(j);var l=function(b){a(k).attr("disabled","disabled");a(k).text(b)},m=b.get_strings([{key:"drift_testconnection",component:"local_drift"},{key:"drift_buttondisabled",component:"local_drift"}]);a.when(m).done(function(b){var c=a("#id_s_local_drift_clientkey");if(""==c.val()){l(b[1])}else{k.text(b[0])}a(c).on("input",function(){l(b[1])})});var n=b.get_strings([{key:"drift_testconnection",component:"local_drift"},{key:"drift_connection_verified",component:"local_drift"},{key:"drift_connection_fail",component:"local_drift"}]),o=[];a.when(n).done(function(a){o=a;c.create({title:a[0],body:d.render("local_drift/settings",{}),type:c.types.DEFAULT},k).done(function(){h.append(i)})});k.click(function(b){b.preventDefault();t();a("#drift_result").text("...");var c=f.getScript(g);if(M.cfg.behatsiterunning){var d=M.cfg.wwwroot+"/local/drift/tests/fixtures/";c.src=g.trim()=="right-password".trim()?d+"dummy-drift.js":d+"empty.js"}a.get(c.src).done(function(){r(p,20).then(function(){q(!0,o[1])});f.testConnection(g)}).fail(function(){r(p,20).then(function(){q(!1,o[2])})})});var p=function(){return 0!==a("#drift_testing").length},q=function(b,c){s(b);a("#drift_result").text(c)},r=function(b,c){c=!c?10:c;var d=a.Deferred(),e=0,f=setInterval(function(){e=e+1;if(e>c){d.reject();clearInterval(f)}else{if(b()){d.resolve();clearInterval(f)}}},1e3);return d.promise()},s=function(b){if(b){if(a("#drift_testing").hasClass("alert-warning")){a("#drift_testing").removeClass("alert-warning").addClass("alert-success")}else if(a("#drift_testing").hasClass("alert-danger")){a("#drift_testing").removeClass("alert-danger").addClass("alert-success")}}else{if(a("#drift_testing").hasClass("alert-warning")){a("#drift_testing").removeClass("alert-warning").addClass("alert-danger")}else if(a("#drift_testing").hasClass("alert-success")){a("#drift_testing").removeClass("alert-success").addClass("alert-danger")}}},t=function(){if(a("#drift_testing").hasClass("alert-success")){a("#drift_testing").removeClass("alert-success").addClass("alert-warning")}else if(a("#drift_testing").hasClass("alert-danger")){a("#drift_testing").removeClass("alert-danger").addClass("alert-warning")}}}}});
//# sourceMappingURL=settings.min.js.map
